<!doctype html><html lang=en><head><meta charset=utf-8><title>Tiny Great Languages: BASIC</title><meta name=description content="Entering the microcomputer era and attempting to create a programming language that dominated home computers in the 1970s"><meta name=author content="Serge Zaitsev"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=data:,><link rel="shortcut icon" sizes=32x32 href=/favicon.png><link rel="shortcut icon" sizes=192x192 href=/favicon-192x192.png><link rel=apple-touch-icon href=/favicon-192x192.png><link rel=alternate type=application/rss+xml title=RSS href=/rss.xml><link rel=canonical href=https://zserge.com/posts/langs-basic/><meta property="og:title" content="Tiny Great Languages: BASIC"><meta property="og:type" content="article"><meta property="og:url" content="https://zserge.com/posts/langs-basic/"><meta property="og:image" content="https://zserge.com/logo.png"><meta property="og:description" content="Entering the microcomputer era and attempting to create a programming language that dominated home computers in the 1970s"><meta property="og:locale" content="en_US"><meta name=twitter:card content="Entering the microcomputer era and attempting to create a programming language that dominated home computers in the 1970s"><meta name=twitter:site content="@zsergo"><style type=text/css>body{padding:1rem;margin:auto;max-width:46rem;font-family:pt serif,Georgia,Cambria,times new roman,Times,serif;line-height:1.5;font-size:20px;color:rgba(0,0,0,.87);-webkit-font-smoothing:antialiased;font-weight:300}nav{display:flex;justify-content:space-between;align-items:center;margin:1em 0 3em}nav ul,nav li{display:inline-block;list-style:none;margin:0 0 0 .5rem;padding:0}nav ul{margin-right:1rem}.logo{background-color:rgba(0,0,0,.87);color:#fff;min-width:48px;min-height:48px;font-size:28px;border-radius:2px;display:flex;justify-content:center;align-items:center}.logo:hover{color:#fff}h1,h2{line-height:1.2;font-family:roboto,system-ui,segoe ui,Helvetica,Arial,sans-serif;font-weight:400;text-transform:uppercase;margin:1.34em 0 0}h1{font-size:1.95em}h2{font-size:1.25em;border-bottom:2px solid rgba(0,0,0,.87)}h1 a{color:rgba(0,0,0,.87)}p{margin:.67em 0 1em}a{color:#0076df;text-decoration:none;word-break:break-word}a:hover{color:rgba(0,0,0,.87)}ul,ol{list-style-position:outside;margin-left:1em}img{display:block;margin-left:auto;margin-right:auto;max-width:100%}pre,code{font-family:roboto mono,SFMono-Regular,Consolas,liberation mono,Menlo,monospace;font-weight:400;font-size:18px;color:rgba(0,0,0,.6);background:#eee}code{padding:.2rem .4rem;font-size:14px;border-radius:2px}pre{overflow-y:auto;line-height:20px;border-radius:2px;padding:1em}pre code{font-size:14px;padding:0;color:rgba(0,0,0,.87)}footer{font-size:12px}@media(prefers-color-scheme:dark){.logo{color:#444;background-color:#e4e4e4}.logo:hover{color:#444}body,h1 a,h2 a{background-color:#444;color:#e4e4e4}pre,pre code{background:#333;color:#e4e4e4}h2{border-bottom:1px solid #e4e4e4}code{color:#aaa;background:#333}a{color:#e39777}a:hover{color:#e4e4e4}img{filter:grayscale(30%)}}.hl{display:block;width:100%;background-color:#ffc}.ow,.gh,.gp,.gs,.gu,.nt,.nn,.ne,.ni,.nc,.kr,.kn,.kd,.kc,.k{font-weight:700}.c,.ch,.cm,.c1,.cs,.ge{color:#777}</style><link rel="shortcut icon" href=/favicon.ico></head><body><header><nav><a class=logo href=/>Z</a><ul><li><a href=/about/>about</a></li><li><a href=/posts/>posts</a></li><li><a href=https://mastodon.social/@zserge rel=me>@me</a></li><li><a href=https://github.com/zserge rel=me>&lt;/>me</a></li></ul></nav></header><div id=content><h1>Tiny Great Languages: BASIC</h1><p><em>This is part 2 from series &ldquo;Tiny Great Languages&rdquo;.</em></p><ul><li><em>Final code is on <a href=https://github.com/zserge/tinylangs>Github</a>.</em></li><li><em><a href=/posts/langs-asm/>Part 1: Assembly</a>.</em></li><li><em><a href=/posts/langs-basic/>Part 2: BASIC</a>.</em></li><li><em><a href=/posts/langs-mouse/>Part 3: Forth/MOUSE</a>.</em></li><li><em><a href=/posts/langs-lisp/>Part 4: Lisp</a>.</em></li><li><em><a href=/posts/langs-apl/>Part 5: APL/K</a>.</em></li><li><em><a href=/posts/langs-pl0/>Part 6: PL/0</a>.</em></li></ul><p>Meet BASIC, the king of home computing in the late 1970s. Originally designed to promote computer literacy in schools, BASIC inspired a whole generation of professional software engineers.</p><p>BASIC typically combined a simple text editor with a command shell and interpreter. Lines starting with a number were added, deleted, or edited in the program space, while lines without numbers were executed immediately. For example:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>NEW
20 B=1
10 A=5
30 PRINT A+B
20 B=7
RUN
</code></pre></div><p>Here, NEW and RUN are immediate commands &ndash; <code>NEW</code> clears the user program, and <code>RUN</code> executes it. Numbered lines are stored in order, and typing the <code>LIST</code> command would display the entire program:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>10 A=5
20 B=7
30 PRINT A+B
</code></pre></div><p>The outer loop of our BASIC would be simple, we have a luxury to store lines of code in a hash map (unlike the old BASICs that had to run on just a few kilobytes of RAM and stored very compact tokenised input instead):</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>code</span> <span class=o>=</span> <span class=p>{}</span>

<span class=c1># Cut a number from a string and return the rest,</span>
<span class=c1># i.e. &#34;10 A=3&#34; -&gt; (10, &#34; A=3&#34;), &#34;LIST&#34; -&gt; (0, &#34;LIST&#34;)</span>
<span class=k>def</span> <span class=nf>num</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>while</span> <span class=n>s</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span> <span class=n>n</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>n</span> <span class=o>*</span> <span class=mi>10</span> <span class=o>+</span> <span class=nb>int</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
    <span class=k>return</span> <span class=n>n</span><span class=p>,</span> <span class=n>s</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>

<span class=k>def</span> <span class=nf>stmt</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=o>....</span>

<span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>sys</span><span class=o>.</span><span class=n>stdin</span><span class=p>:</span>
    <span class=n>lineno</span><span class=p>,</span> <span class=n>line</span> <span class=o>=</span> <span class=n>num</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>lineno</span><span class=p>:</span> <span class=n>code</span><span class=p>[</span><span class=n>lineno</span><span class=p>]</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
    <span class=k>else</span><span class=p>:</span> <span class=n>stmt</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</code></pre></div><p>Numbered lines are stored in <code>code</code>, empty lines effectively &ldquo;delete&rdquo; code. Otherwise, lines are executed by the <code>stmt()</code> function, which is the core of our BASIC interpreter. Simple commands can be handled with one-liners in Python &ndash; <code>NEW</code> is <code>code.clear()</code>, <code>BYE</code> is <code>sys.exit(0)</code>, <code>REM</code> is a no-op and <code>LIST</code> is:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>print(&#34;\n&#34;.join([f&#34;{n:3} {ln}&#34; for (n, ln) in sorted(code.items()) if ln]))
</code></pre></div><p>Although we are targeting an extremely tiny BASIC subset, we still need to support <code>GOTO</code>. Our <code>stmt()</code> function will handle jumping between the lines by keeping track of the &ldquo;current line number&rdquo;. For simplicity, we&rsquo;ll introduce a variable table (dict), and make line number a special variable named <code>#</code> (because it&rsquo;s a number, plus there were a few <a href=https://altairclone.com/downloads/roms/VTL-2%20(Very%20Tiny%20Language)/VTL-2%20Manual.pdf>BASIC dialects</a> that used this notation).</p><p>Now we can complete the <code>stmt()</code> function:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>stmt</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>do_if</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
        <span class=n>n</span><span class=p>,</span> <span class=n>ln</span> <span class=o>=</span> <span class=n>expr</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>n</span><span class=p>:</span>
            <span class=n>stmt</span><span class=p>(</span><span class=n>ln</span><span class=p>)</span>

    <span class=k>while</span> <span class=n>s</span> <span class=o>!=</span> <span class=bp>None</span><span class=p>:</span>
        <span class=n>cmd</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=bp>None</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
        <span class=nb>vars</span><span class=p>[</span><span class=s2>&#34;#&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span> <span class=k>if</span> <span class=nb>vars</span><span class=p>[</span><span class=s2>&#34;#&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=mi>0</span>
        <span class=n>ops</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&#34;rem&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=bp>None</span><span class=p>,</span>
            <span class=s2>&#34;new&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=n>code</span><span class=o>.</span><span class=n>clear</span><span class=p>(),</span>
            <span class=s2>&#34;bye&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
            <span class=s2>&#34;list&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=k>print</span><span class=p>(</span>
                <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>f</span><span class=s2>&#34;{n:3} {ln}&#34;</span> <span class=k>for</span> <span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>ln</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>code</span><span class=o>.</span><span class=n>items</span><span class=p>())</span> <span class=k>if</span> <span class=n>ln</span><span class=p>])</span>
            <span class=p>),</span>
            <span class=s2>&#34;print&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=k>print</span><span class=p>(</span>
                <span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=n>args</span> <span class=ow>and</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;&#34;&#39;</span> <span class=k>else</span> <span class=n>expr</span><span class=p>(</span><span class=n>args</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
            <span class=p>),</span>
            <span class=s2>&#34;input&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=nb>vars</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;] &#34;</span><span class=p>))}),</span>
            <span class=s2>&#34;goto&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=nb>vars</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&#34;#&#34;</span><span class=p>:</span> <span class=n>expr</span><span class=p>(</span><span class=n>args</span><span class=p>)[</span><span class=mi>0</span><span class=p>]}),</span>
            <span class=s2>&#34;if&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=n>do_if</span><span class=p>(</span><span class=n>args</span><span class=p>),</span>
            <span class=s2>&#34;run&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=nb>vars</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&#34;#&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}),</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=n>cmd</span> <span class=ow>and</span> <span class=n>cmd</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=n>ops</span><span class=p>:</span>
            <span class=n>ops</span><span class=p>[</span><span class=n>cmd</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()](</span><span class=n>cmd</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
        <span class=k>elif</span> <span class=n>s</span><span class=p>:</span>
            <span class=n>assign</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;=&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
            <span class=nb>vars</span><span class=p>[</span><span class=n>assign</span><span class=p>[</span><span class=mi>0</span><span class=p>]],</span> <span class=n>_</span> <span class=o>=</span> <span class=n>expr</span><span class=p>(</span><span class=n>assign</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
        <span class=k>if</span> <span class=nb>vars</span><span class=p>[</span><span class=s2>&#34;#&#34;</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>break</span>
        <span class=nb>vars</span><span class=p>[</span><span class=s2>&#34;#&#34;</span><span class=p>],</span> <span class=n>s</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span>
            <span class=p>((</span><span class=n>n</span><span class=p>,</span> <span class=n>ln</span><span class=p>)</span> <span class=k>for</span> <span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>ln</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>code</span><span class=o>.</span><span class=n>items</span><span class=p>())</span> <span class=k>if</span> <span class=n>n</span> <span class=o>&gt;=</span> <span class=nb>vars</span><span class=p>[</span><span class=s2>&#34;#&#34;</span><span class=p>]),</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>None</span><span class=p>)</span>
        <span class=p>)</span>
</code></pre></div><p>Our BASIC only supports 4 commands: <code>PRINT</code> for output, <code>INPUT</code> for reading numbers from console, <code>GOTO</code> for loops and jumps, <code>IF</code> for conditional execution. The rest are rather editing commands and provide an interactive shell: <code>REM</code> is a comment, <code>NEW</code> clears the code space, <code>BYE</code> exits back to the OS shell (although in most cases BASIC <em>was</em> the OS shell), <code>LIST</code> prints full code on display.</p><p>Out <code>stmt()</code> function however relies on another <code>expr()</code> function for evaluating math expressions, which can be implemented as a recursive descent parser:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=nb>vars</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;#&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>

<span class=k>def</span> <span class=nf>expr</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=n>res</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>term</span><span class=p>(</span><span class=n>s</span><span class=p>);</span> <span class=n>op</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
    <span class=k>while</span> <span class=n>s</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=ow>in</span> <span class=s2>&#34;+-&#34;</span><span class=p>:</span>
        <span class=n>op</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>n</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>term</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:])</span>
        <span class=n>res</span> <span class=o>+=</span> <span class=n>n</span> <span class=k>if</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&#34;+&#34;</span> <span class=k>else</span> <span class=o>-</span><span class=n>n</span>
    <span class=k>return</span> <span class=n>res</span><span class=p>,</span> <span class=n>s</span>

<span class=k>def</span> <span class=nf>term</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=n>res</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>factor</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>s</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=ow>in</span> <span class=s2>&#34;*/&#34;</span><span class=p>:</span>
        <span class=n>op</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>n</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>factor</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:])</span>
        <span class=n>res</span> <span class=o>*=</span> <span class=n>n</span> <span class=k>if</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&#34;*&#34;</span> <span class=k>else</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>n</span> <span class=k>if</span> <span class=n>n</span> <span class=o>!=</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
    <span class=k>return</span> <span class=n>res</span><span class=p>,</span> <span class=n>s</span>

<span class=k>def</span> <span class=nf>factor</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>s</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;(&#34;</span><span class=p>:</span> <span class=n>res</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>expr</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:]);</span> <span class=k>return</span> <span class=n>res</span><span class=p>,</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
    <span class=k>elif</span> <span class=n>s</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span> <span class=k>return</span> <span class=n>num</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>isalnum</span><span class=p>():</span> <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
        <span class=k>return</span> <span class=nb>vars</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>s</span><span class=p>[:</span><span class=n>i</span><span class=p>],</span> <span class=mi>0</span><span class=p>),</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>:]</span>
</code></pre></div><p>Adding more operations isn&rsquo;t that hard (to add <code>&lt;</code>, <code>></code>, <code>=</code> and <code>#</code> as a not-equal operator), but is left as an exercise to the reader.</p><p>Putting all the code pieces together - we get a BASIC interpreter/shell in 53 lines of code!</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>sys</span>

<span class=n>code</span><span class=p>,</span> <span class=nb>vars</span> <span class=o>=</span> <span class=p>{},</span> <span class=p>{</span><span class=s2>&#34;#&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>

<span class=k>def</span> <span class=nf>num</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>while</span> <span class=n>s</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span> <span class=n>n</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>n</span> <span class=o>*</span> <span class=mi>10</span> <span class=o>+</span> <span class=nb>int</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
    <span class=k>return</span> <span class=n>n</span><span class=p>,</span> <span class=n>s</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>

<span class=k>def</span> <span class=nf>expr</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=n>res</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>term</span><span class=p>(</span><span class=n>s</span><span class=p>);</span> <span class=n>op</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
    <span class=k>while</span> <span class=n>s</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=ow>in</span> <span class=s2>&#34;+-&#34;</span><span class=p>:</span>
        <span class=n>op</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>n</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>term</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:])</span>
        <span class=n>res</span> <span class=o>+=</span> <span class=n>n</span> <span class=k>if</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&#34;+&#34;</span> <span class=k>else</span> <span class=o>-</span><span class=n>n</span>
    <span class=k>return</span> <span class=n>res</span><span class=p>,</span> <span class=n>s</span>


<span class=k>def</span> <span class=nf>term</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=n>res</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>factor</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>s</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=ow>in</span> <span class=s2>&#34;*/&#34;</span><span class=p>:</span>
        <span class=n>op</span> <span class=o>=</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>n</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>factor</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:])</span>
        <span class=n>res</span> <span class=o>*=</span> <span class=n>n</span> <span class=k>if</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&#34;*&#34;</span> <span class=k>else</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>n</span> <span class=k>if</span> <span class=n>n</span> <span class=o>!=</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
    <span class=k>return</span> <span class=n>res</span><span class=p>,</span> <span class=n>s</span>


<span class=k>def</span> <span class=nf>factor</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>s</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;(&#34;</span><span class=p>:</span> <span class=n>res</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>expr</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:]);</span> <span class=k>return</span> <span class=n>res</span><span class=p>,</span> <span class=n>s</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
    <span class=k>elif</span> <span class=n>s</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span> <span class=k>return</span> <span class=n>num</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=ow>and</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>isalnum</span><span class=p>():</span> <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
        <span class=k>return</span> <span class=nb>vars</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>s</span><span class=p>[:</span><span class=n>i</span><span class=p>],</span> <span class=mi>0</span><span class=p>),</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>:]</span>


<span class=k>def</span> <span class=nf>stmt</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>do_if</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
        <span class=n>n</span><span class=p>,</span> <span class=n>ln</span> <span class=o>=</span> <span class=n>expr</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>n</span><span class=p>:</span> <span class=n>stmt</span><span class=p>(</span><span class=n>ln</span><span class=p>)</span>

    <span class=k>while</span> <span class=n>s</span> <span class=o>!=</span> <span class=bp>None</span><span class=p>:</span>
        <span class=n>cmd</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=bp>None</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
        <span class=nb>vars</span><span class=p>[</span><span class=s2>&#34;#&#34;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span> <span class=k>if</span> <span class=nb>vars</span><span class=p>[</span><span class=s2>&#34;#&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=mi>0</span>
        <span class=n>ops</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s2>&#34;rem&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=bp>None</span><span class=p>,</span>
            <span class=s2>&#34;new&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=n>code</span><span class=o>.</span><span class=n>clear</span><span class=p>(),</span>
            <span class=s2>&#34;bye&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
            <span class=s2>&#34;list&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=k>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>f</span><span class=s2>&#34;{n:3} {ln}&#34;</span> <span class=k>for</span> <span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>ln</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>code</span><span class=o>.</span><span class=n>items</span><span class=p>())</span> <span class=k>if</span> <span class=n>ln</span><span class=p>])),</span>
            <span class=s2>&#34;print&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=k>print</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=n>args</span> <span class=ow>and</span> <span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;&#34;&#39;</span> <span class=k>else</span> <span class=n>expr</span><span class=p>(</span><span class=n>args</span><span class=p>)[</span><span class=mi>0</span><span class=p>]),</span>
            <span class=s2>&#34;input&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=nb>vars</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=n>args</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;] &#34;</span><span class=p>))}),</span>
            <span class=s2>&#34;goto&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=nb>vars</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&#34;#&#34;</span><span class=p>:</span> <span class=n>expr</span><span class=p>(</span><span class=n>args</span><span class=p>)[</span><span class=mi>0</span><span class=p>]}),</span>
            <span class=s2>&#34;if&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=n>do_if</span><span class=p>(</span><span class=n>args</span><span class=p>),</span>
            <span class=s2>&#34;run&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>args</span><span class=p>:</span> <span class=nb>vars</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=s2>&#34;#&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}),</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=n>cmd</span> <span class=ow>and</span> <span class=n>cmd</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=n>ops</span><span class=p>:</span> <span class=n>ops</span><span class=p>[</span><span class=n>cmd</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>lower</span><span class=p>()](</span><span class=n>cmd</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
        <span class=k>elif</span> <span class=n>s</span><span class=p>:</span> <span class=n>assign</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;=&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span> <span class=nb>vars</span><span class=p>[</span><span class=n>assign</span><span class=p>[</span><span class=mi>0</span><span class=p>]],</span> <span class=n>_</span> <span class=o>=</span> <span class=n>expr</span><span class=p>(</span><span class=n>assign</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
        <span class=k>if</span> <span class=nb>vars</span><span class=p>[</span><span class=s2>&#34;#&#34;</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span> <span class=k>break</span>
        <span class=nb>vars</span><span class=p>[</span><span class=s2>&#34;#&#34;</span><span class=p>],</span> <span class=n>s</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(((</span><span class=n>n</span><span class=p>,</span> <span class=n>ln</span><span class=p>)</span> <span class=k>for</span> <span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>ln</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>code</span><span class=o>.</span><span class=n>items</span><span class=p>())</span> <span class=k>if</span> <span class=n>n</span> <span class=o>&gt;=</span> <span class=nb>vars</span><span class=p>[</span><span class=s2>&#34;#&#34;</span><span class=p>]),</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>None</span><span class=p>))</span>


<span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>sys</span><span class=o>.</span><span class=n>stdin</span><span class=p>:</span>
    <span class=n>lineno</span><span class=p>,</span> <span class=n>line</span> <span class=o>=</span> <span class=n>num</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>lineno</span><span class=p>:</span> <span class=n>code</span><span class=p>[</span><span class=n>lineno</span><span class=p>]</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
    <span class=k>else</span><span class=p>:</span> <span class=n>stmt</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</code></pre></div><p>Despite its size, it is surprisingly powerful and easy to extend. You can add more commands by simply dropping lambdas into the ops dictionary or enhance the expr/factor/term logic for better arithmetic support. Adding loops (<code>FOR .. TO .. NEXT</code>) is also possible and would require keeping track of loop start addresses and counter boundaries. Adding <code>GOSUB</code> and <code>RETURN</code> is even simpler and requires storing a global call stack (to remember return addresses when entering a subroutine).</p><p>Can our BASIC calculate a factorial, though?</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>REM
REM Factorial program (fac.bas)
REM

NEW

10  PRINT &#34;Enter N:&#34;
20  INPUT N
30  F=1
50  IF N GOTO 70
60  GOTO 100
70  F=F*N
80  N=N-1
90  GOTO 50
100 PRINT F

LIST
PRINT &#34;&#34;
PRINT &#34;Try 10!...&#34;
RUN
</code></pre></div><p>Running <code>python3 basic.py &lt; fac.bas</code> gives us the correct factorials, try it yourself!</p><p>While BASIC has been criticized for its lack of structured programming features, I still believe it&rsquo;s a fantastic language for beginners. I&rsquo;ve seen 10-year-olds struggle with Python, JavaScript and other &ldquo;modern&rdquo; languages, yet they light up when creating simple games in BASIC on retrocomputer emulators!</p><p>As an inspiration for exploring BASICs I&rsquo;d suggest implementing a full TinyBASIC dialect, then add strings and arrays, maybe named functions and of course run a &ldquo;STARTREK.BAS&rdquo; on it! Or try writing a BASIC in Assembly to get the real taste of how the original BASICs were made.</p><p>In the next part we&rsquo;ll move on to concatenative languages, stay tuned!</p><p>I hope you’ve enjoyed this article. You can follow – and contribute to – on <a href=https://github.com/zserge>Github</a>, <a href=https://mastodon.social/@zserge>Mastodon</a>, <a href=https://twitter.com/zsergo>Twitter</a> or subscribe via <a href=/rss.xml>rss</a>.</p><p class=date style=text-align:right><em>Sep 10, 2024</em></p><p>See also:
<a href=/posts/langs-asm/>Tiny Great Languages: Assembly</a> and <a href=/posts/>more</a>.</p></div><footer><p>&copy;2012&ndash;2024 &#183;
<a class=h-card rel=me href=https://zserge.com/>Serge Zaitsev</a> &#183;
<a href=mailto:hello@zserge.com rel=me>hello@zserge.com</a> &#183;
<a href=https://mastodon.social/@zserge rel=me>@zserge@mastodon.social</a></p></footer><script>new Image().src='https://nullitics.com/file.gif?u='+encodeURI(location.href)+'&r='+encodeURI(document.referrer)+'&d='+screen.width</script><noscript><img src=https://nullitics.com/file.gif></noscript></body></html>