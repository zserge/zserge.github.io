<!doctype html><html lang=en><head><meta charset=utf-8><title>CSS-in-JS in 200 bytes</title><meta name=description content="Learning how CSS-in-JS works by building one from scratch and squeezing it into a barely noticeable size."><meta name=author content="Serge Zaitsev"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=data:,><link rel="shortcut icon" sizes=32x32 href=/favicon.png><link rel="shortcut icon" sizes=192x192 href=/favicon-192x192.png><link rel=apple-touch-icon href=/favicon-192x192.png><link rel=alternate type=application/rss+xml title=RSS href=/rss.xml><link rel=canonical href=https://zserge.com/posts/css-in-js/><meta property="og:title" content="CSS-in-JS in 200 bytes"><meta property="og:type" content="article"><meta property="og:url" content="https://zserge.com/posts/css-in-js/"><meta property="og:image" content="https://zserge.com/logo.png"><meta property="og:description" content="Learning how CSS-in-JS works by building one from scratch and squeezing it into a barely noticeable size."><meta property="og:locale" content="en_US"><meta name=twitter:card content="Learning how CSS-in-JS works by building one from scratch and squeezing it into a barely noticeable size."><meta name=twitter:site content="@zsergo"><style type=text/css>body{padding:1rem;margin:auto;max-width:46rem;font-family:pt serif,Georgia,Cambria,times new roman,Times,serif;line-height:1.5;font-size:20px;color:rgba(0,0,0,.87);-webkit-font-smoothing:antialiased;font-weight:300}nav{display:flex;justify-content:space-between;align-items:center;margin:1em 0 3em}nav ul,nav li{display:inline-block;list-style:none;margin:0 0 0 .5rem;padding:0}nav ul{margin-right:1rem}.logo{background-color:rgba(0,0,0,.87);color:#fff;min-width:48px;min-height:48px;font-size:28px;border-radius:2px;display:flex;justify-content:center;align-items:center}.logo:hover{color:#fff}h1,h2{line-height:1.2;font-family:roboto,system-ui,segoe ui,Helvetica,Arial,sans-serif;font-weight:400;text-transform:uppercase;margin:1.34em 0 0}h1{font-size:1.95em}h2{font-size:1.25em;border-bottom:2px solid rgba(0,0,0,.87)}h1 a{color:rgba(0,0,0,.87)}p{margin:.67em 0 1em}a{color:#0076df;text-decoration:none;word-break:break-word}a:hover{color:rgba(0,0,0,.87)}ul,ol{list-style-position:outside;margin-left:1em}img{display:block;margin-left:auto;margin-right:auto;max-width:100%}pre,code{font-family:roboto mono,SFMono-Regular,Consolas,liberation mono,Menlo,monospace;font-weight:400;font-size:18px;color:rgba(0,0,0,.6);background:#eee}code{padding:.2rem .4rem;font-size:14px;border-radius:2px}pre{overflow-y:auto;line-height:20px;border-radius:2px;padding:1em}pre code{font-size:14px;padding:0;color:rgba(0,0,0,.87)}footer{font-size:12px}@media(prefers-color-scheme:dark){.logo{color:#444;background-color:#e4e4e4}.logo:hover{color:#444}body,h1 a,h2 a{background-color:#444;color:#e4e4e4}pre,pre code{background:#333;color:#e4e4e4}h2{border-bottom:1px solid #e4e4e4}code{color:#aaa;background:#333}a{color:#e39777}a:hover{color:#e4e4e4}img{filter:grayscale(30%)}}.hl{display:block;width:100%;background-color:#ffc}.ow,.gh,.gp,.gs,.gu,.nt,.nn,.ne,.ni,.nc,.kr,.kn,.kd,.kc,.k{font-weight:700}.c,.ch,.cm,.c1,.cs,.ge{color:#777}</style><link rel="shortcut icon" href=/favicon.ico></head><body><header><nav><a class=logo href=/>Z</a><ul><li><a href=/about/>about</a></li><li><a href=/posts/>posts</a></li><li><a href=https://mastodon.social/@zserge rel=me>@me</a></li><li><a href=https://github.com/zserge rel=me>&lt;/>me</a></li></ul></nav></header><div id=content><h1>CSS-in-JS in 200 bytes</h1><p>CSS-in-JS is a relatively new and a very contradictory way of writing CSS. On the one hand, it tries to overcome the limitations of traditional CSS to make it more reusable, especially when it comes to styling components. On the other hand, it&rsquo;s different from traditional CSS and has it&rsquo;s own disadvantages.</p><p>There is no single CSS-in-JS library, there is even no sight of a clear winner in this race. However, all CSS-in-JS <a href=https://github.com/streamich/freestyler/blob/master/docs/en/generations.md>implementations</a> have a lot in common - they allow creating isolated reusable styles for components and use JavaScript as a language for writing styles.</p><h2 id=pros-and-cons>Pros and cons</h2><p>The most obvious benefit of using CSS-in-JS is that your styling is now connected very closely to your component - you remove the component and the related styles are gone, you modify the component - and you can be sure that it&rsquo;s style depends only on what is declared in this very component, you don&rsquo;t have to scan through all your CSS files to find the rule that unintentionally breaks all your styling. All styles belong to the individual component scopes.</p><p>Moreover, the newest CSS-in-JS libraries bring lots of power when it comes to dynamic styling - your CSS may depend on your component properties and even arbitrary variables in your render() routine. It can be a good thing, it can also be dangerously bad, but it&rsquo;s definitely a powerful tool (and thus should be used with care).</p><p>However, everything comes at a price. If you go for CSS-in-JS - it means that you bring yet another layer into your tooling, yet another build step, yet another dependency. Also, some libraries have a very peculiar syntax which makes your CSS look neither like CSS nor like JS.</p><p>Now, can we build something that keeps the good parts and reduces the bad?</p><h2 id=meet-zercss>Meet zercss</h2><p>This will be a run-time CSS injector. In other words, there will be extra build step to create or process CSS files.</p><p>In this case, the first thing to do is to inject a new stylesheet into the document:</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>style</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s1>&#39;style&#39;</span><span class=p>);</span>
<span class=nx>style</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s1>&#39;style&#39;</span><span class=p>,</span> <span class=s1>&#39;text/css&#39;</span><span class=p>);</span>
<span class=nb>document</span><span class=p>.</span><span class=nx>head</span><span class=p>.</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>style</span><span class=p>);</span>
<span class=c1>// We can inject custom CSS like this:
</span><span class=c1></span><span class=nx>style</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=s1>&#39;body { background: red; }&#39;</span><span class=p>;</span>
</code></pre></div><p>This style node will be used to append CSS blocks of each style that will be defined in our JS code.</p><p>The dumbest possible implementation would be:</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>css</span> <span class=o>=</span> <span class=nx>s</span> <span class=p>=&gt;</span> <span class=nx>style</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>+=</span> <span class=nx>s</span><span class=p>;</span>

<span class=c1>// Example:
</span><span class=c1></span><span class=nx>css</span><span class=p>(</span><span class=sb>`
</span><span class=sb>* { margin: 0; padding: 0; }
</span><span class=sb>body { font-family: &#39;Roboto&#39;, sans-serif; }
</span><span class=sb>`</span><span class=p>);</span>
</code></pre></div><p>This will inject parts of CSS into the global stylesheet, but it won&rsquo;t be <em>scoped</em> CSS. To make it scoped we need to create random unique class-names for each CSS block, and return the class name so that it could be used in the component. For example:</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kd>let</span> <span class=nx>nextID</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
<span class=kr>const</span> <span class=nx>css</span> <span class=o>=</span> <span class=nx>s</span> <span class=p>=&gt;</span> <span class=p>{</span>
  <span class=kr>const</span> <span class=nx>id</span> <span class=o>=</span> <span class=s1>&#39;z&#39;</span> <span class=o>+</span> <span class=p>(</span><span class=o>++</span><span class=nx>nextID</span><span class=p>);</span>
  <span class=nx>style</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>+=</span> <span class=sb>`.</span><span class=si>${</span><span class=nx>id</span><span class=si>}</span><span class=sb> { </span><span class=si>${</span><span class=nx>s</span><span class=si>}</span><span class=sb> }`</span><span class=p>;</span>
  <span class=k>return</span> <span class=nx>id</span><span class=p>;</span>
<span class=p>};</span>

<span class=c1>// Create CSS blocks and generate class names (&#34;z1&#34; and &#34;z2&#34;)
</span><span class=c1></span><span class=kr>const</span> <span class=nx>outer</span> <span class=o>=</span> <span class=nx>css</span><span class=p>(</span><span class=sb>`display: grid; place-items: center;`</span><span class=p>);</span>
<span class=kr>const</span> <span class=nx>inner</span> <span class=o>=</span> <span class=nx>css</span><span class=p>(</span><span class=sb>`width: 100px; height: 100px;`</span><span class=p>);</span>

<span class=c1>// Create layout with the given class names
</span><span class=c1></span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=sb>`
</span><span class=sb>  &lt;div class=</span><span class=si>${</span><span class=nx>outer</span><span class=si>}</span><span class=sb>&gt;
</span><span class=sb>    &lt;div class=</span><span class=si>${</span><span class=nx>inner</span><span class=si>}</span><span class=sb>&gt;&lt;/div&gt;
</span><span class=sb>  &lt;/div&gt;
</span><span class=sb>`</span><span class=p>;</span>
</code></pre></div><p>Now our CSS is kind of scoped, each block belongs to an individual class, but we can&rsquo;t define more than one block of CSS at a time, and we can&rsquo;t define additional selectors, such as <code>:hover</code> or styles for nested elements.</p><p>We can use a special symbol, for example <code>&</code> like Less or SASS do and replace it with the generate class name:</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>css</span> <span class=o>=</span> <span class=nx>s</span> <span class=p>=&gt;</span> <span class=p>{</span>
  <span class=kd>let</span> <span class=nx>id</span> <span class=o>=</span> <span class=s1>&#39;z&#39;</span><span class=o>+</span><span class=p>(</span><span class=o>++</span><span class=nx>nextID</span><span class=p>);</span>
  <span class=nx>style</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>+=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/&amp;/g</span><span class=p>,</span> <span class=sb>`.</span><span class=si>${</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
  <span class=k>return</span> <span class=nx>id</span><span class=p>;</span>
<span class=p>};</span>

<span class=kr>const</span> <span class=nx>outer</span> <span class=o>=</span> <span class=nx>css</span><span class=p>(</span><span class=sb>`
</span><span class=sb>  &amp;       { background-color: red; }
</span><span class=sb>  &amp;:hover { background-color: blue; }
</span><span class=sb>`</span><span class=p>)</span>
</code></pre></div><p>However, this enforces writing a full CSS block with an ampersand selector every time, even if we want it to be short and implicit. Also, such brutal replacement opens another problem with ampersands that are not meant to be replaced (i.e. inside url() links or strings).</p><p>To overcome this, I suggest to make css() a named template literal. Such functions take an array of literal strings and evaluated fields to put in between. We can replace ampersands only inside the literal strings and pass evaluated fields as is. Additionally, we may keep track of how may ampersands have been replaced and wrap the contents into an implicit CSS block if no ampersand was found.</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>css</span> <span class=o>=</span> <span class=p>(</span><span class=nx>strings</span><span class=p>,</span> <span class=p>...</span><span class=nx>values</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
	<span class=kd>let</span> <span class=nx>id</span> <span class=o>=</span> <span class=s1>&#39;z&#39;</span><span class=o>+</span><span class=p>(</span><span class=o>++</span><span class=nx>nextID</span><span class=p>);</span>
	<span class=kd>let</span> <span class=nx>amp</span><span class=p>;</span>
	<span class=kd>let</span> <span class=nx>block</span> <span class=o>=</span> <span class=nx>strings</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>s</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
		<span class=kr>const</span> <span class=nx>prefix</span> <span class=o>=</span> <span class=nx>i</span> <span class=o>?</span> <span class=nx>values</span><span class=p>[</span><span class=nx>i</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
		<span class=k>return</span> <span class=nx>prefix</span> <span class=o>+</span> <span class=nx>s</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/&amp;/g</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>amp</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=o>+</span><span class=nx>id</span><span class=p>);</span>
	<span class=p>}).</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>

	<span class=k>if</span> <span class=p>(</span><span class=nx>amp</span><span class=p>)</span> <span class=p>{</span>
		<span class=c1>// Return CSS block if at least one &#39;&amp;&#39; was found
</span><span class=c1></span>		<span class=nx>style</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>+=</span> <span class=nx>block</span><span class=p>;</span>
	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
		<span class=c1>// Wrap implicit CSS into a block if &#39;&amp;&#39; was not found
</span><span class=c1></span>		<span class=nx>style</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>+=</span> <span class=sb>`.</span><span class=si>${</span><span class=nx>id</span><span class=si>}</span><span class=sb> { </span><span class=si>${</span><span class=nx>block</span><span class=si>}</span><span class=sb> }`</span><span class=p>;</span>
	<span class=p>}</span>
	<span class=k>return</span> <span class=nx>id</span><span class=p>;</span>
<span class=p>};</span>
</code></pre></div><p>Now if we minify this a little bit, we may get something like this:</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kd>let</span> <span class=nx>c</span><span class=p>,</span><span class=nx>d</span><span class=o>=</span><span class=nb>document</span><span class=p>,</span><span class=nx>n</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=nx>style</span><span class=o>=</span><span class=nx>d</span><span class=p>.</span><span class=nx>head</span><span class=p>.</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;style&#34;</span><span class=p>));</span><span class=kr>export</span> <span class=kd>let</span> <span class=nx>css</span><span class=o>=</span><span class=p>(</span><span class=nx>e</span><span class=p>,...</span><span class=nx>t</span><span class=p>)=&gt;(</span><span class=nx>c</span><span class=o>=</span><span class=s2>&#34;z&#34;</span><span class=o>+</span><span class=nx>n</span><span class=o>++</span><span class=p>,</span><span class=nx>d</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=nx>e</span><span class=o>=</span><span class=nx>e</span><span class=p>.</span><span class=nx>map</span><span class=p>(((</span><span class=nx>e</span><span class=p>,</span><span class=nx>l</span><span class=p>)=&gt;(</span><span class=nx>l</span><span class=o>?</span><span class=nx>t</span><span class=p>[</span><span class=nx>l</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>:</span><span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>+</span><span class=nx>e</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/&amp;/g</span><span class=p>,(()=&gt;</span><span class=nx>d</span><span class=o>=</span><span class=s2>&#34;.&#34;</span><span class=o>+</span><span class=nx>c</span><span class=p>)))).</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>),</span><span class=nx>style</span><span class=p>.</span><span class=nx>textContent</span><span class=o>+=</span><span class=nx>d</span><span class=o>?</span><span class=nx>e</span><span class=o>:</span><span class=sb>`.</span><span class=si>${</span><span class=nx>c</span><span class=si>}</span><span class=sb>{</span><span class=si>${</span><span class=nx>e</span><span class=si>}</span><span class=sb>}`</span><span class=p>,</span><span class=nx>c</span><span class=p>);</span>
</code></pre></div><p>Albeit its tiny size (~200 bytes), this code snippet is surprisingly powerful - it can handle media queries, keyframes, multiple selector and even global stylesheets. Just save this snippet as <code>zercss.js</code> and import it from your JS code like:</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>import</span> <span class=p>{</span><span class=nx>css</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./zercss.js&#39;</span><span class=p>;</span>
<span class=kr>const</span> <span class=nx>myStyle</span> <span class=o>=</span> <span class=nx>css</span><span class=sb>`
</span><span class=sb>  color: red;
</span><span class=sb>`</span>
<span class=kr>const</span> <span class=nx>MyDiv</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>myStyle</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>Hello</span><span class=o>!&lt;</span><span class=err>/div&gt;;</span>
</code></pre></div><p>You may find the complete snippet and an example HTML page to test it in this gist: <a href=https://gist.github.com/zserge/b8d4fdfb544617ddf4df74c092063501>https://gist.github.com/zserge/b8d4fdfb544617ddf4df74c092063501</a></p><p>If you have any feedback or found a bug - please leave a comment there.</p><p>I hope you’ve enjoyed this article. You can follow – and contribute to – on <a href=https://github.com/zserge>Github</a>, <a href=https://mastodon.social/@zserge>Mastodon</a>, <a href=https://twitter.com/zsergo>Twitter</a> or subscribe via <a href=/rss.xml>rss</a>.</p><p class=date style=text-align:right><em>Feb 08, 2021</em></p><p>See also:
<a href=/posts/worst-react-ever/>Let's make the worst React ever!</a> and <a href=/posts/>more</a>.</p></div><footer><p>&copy;2012&ndash;2023 &#183;
<a class=h-card rel=me href=https://zserge.com/>Serge Zaitsev</a> &#183;
<a href=mailto:hello@zserge.com rel=me>hello@zserge.com</a> &#183;
<a href=https://mastodon.social/@zserge rel=me>@zserge@mastodon.social</a></p></footer><script>new Image().src='https://nullitics.com/file.gif?u='+encodeURI(location.href)+'&r='+encodeURI(document.referrer)+'&d='+screen.width</script><noscript><img src=https://nullitics.com/file.gif></noscript></body></html>