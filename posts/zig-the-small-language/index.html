<!doctype html><html lang=en><head><meta charset=utf-8><title>Zig, the small language</title><meta name=description content="Zig programming language is new, but it's getting a well deserved attention. Can it be a good fit for small-and-simple programming tasks?"><meta name=author content="Serge Zaitsev"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=data:,><link rel="shortcut icon" sizes=32x32 href=/favicon.png><link rel="shortcut icon" sizes=192x192 href=/favicon-192x192.png><link rel=apple-touch-icon href=/favicon-192x192.png><link rel=alternate type=application/rss+xml title=RSS href=/rss.xml><link rel=canonical href=https://zserge.com/posts/zig-the-small-language/><meta property="og:title" content="Zig, the small language"><meta property="og:type" content="article"><meta property="og:url" content="https://zserge.com/posts/zig-the-small-language/"><meta property="og:image" content="https://zserge.com/logo.png"><meta property="og:description" content="Zig programming language is new, but it's getting a well deserved attention. Can it be a good fit for small-and-simple programming tasks?"><meta property="og:locale" content="en_US"><meta name=twitter:card content="Zig programming language is new, but it's getting a well deserved attention. Can it be a good fit for small-and-simple programming tasks?"><meta name=twitter:site content="@zsergo"><style type=text/css>body{padding:1rem;margin:auto;max-width:46rem;font-family:pt serif,Georgia,Cambria,times new roman,Times,serif;line-height:1.5;font-size:20px;color:rgba(0,0,0,.87);-webkit-font-smoothing:antialiased;font-weight:300}nav{display:flex;justify-content:space-between;align-items:center;margin:1em 0 3em}nav ul,nav li{display:inline-block;list-style:none;margin:0 0 0 .5rem;padding:0}nav ul{margin-right:1rem}.logo{background-color:rgba(0,0,0,.87);color:#fff;min-width:48px;min-height:48px;font-size:28px;border-radius:2px;display:flex;justify-content:center;align-items:center}.logo:hover{color:#fff}h1,h2{line-height:1.2;font-family:roboto,system-ui,segoe ui,Helvetica,Arial,sans-serif;font-weight:400;text-transform:uppercase;margin:1.34em 0 0}h1{font-size:1.95em}h2{font-size:1.25em;border-bottom:2px solid rgba(0,0,0,.87)}h1 a{color:rgba(0,0,0,.87)}p{margin:.67em 0 1em}a{color:#0076df;text-decoration:none;word-break:break-word}a:hover{color:rgba(0,0,0,.87)}ul,ol{list-style-position:outside;margin-left:1em}img{display:block;margin-left:auto;margin-right:auto;max-width:100%}pre,code{font-family:roboto mono,SFMono-Regular,Consolas,liberation mono,Menlo,monospace;font-weight:400;font-size:18px;color:rgba(0,0,0,.6);background:#eee}code{padding:.2rem .4rem;font-size:14px;border-radius:2px}pre{overflow-y:auto;line-height:20px;border-radius:2px;padding:1em}pre code{font-size:14px;padding:0;color:rgba(0,0,0,.87)}footer{font-size:12px}@media(prefers-color-scheme:dark){.logo{color:#444;background-color:#e4e4e4}.logo:hover{color:#444}body,h1 a,h2 a{background-color:#444;color:#e4e4e4}pre,pre code{background:#333;color:#e4e4e4}h2{border-bottom:1px solid #e4e4e4}code{color:#aaa;background:#333}a{color:#e39777}a:hover{color:#e4e4e4}img{filter:grayscale(30%)}}.hl{display:block;width:100%;background-color:#ffc}.ow,.gh,.gp,.gs,.gu,.nt,.nn,.ne,.ni,.nc,.kr,.kn,.kd,.kc,.k{font-weight:700}.c,.ch,.cm,.c1,.cs,.ge{color:#777}</style><link rel="shortcut icon" href=/favicon.ico></head><body><header><nav><a class=logo href=/>Z</a><ul><li><a href=/about/>about</a></li><li><a href=/posts/>posts</a></li><li><a href=https://twitter.com/zsergo rel=me>@me</a></li><li><a href=https://github.com/zserge rel=me>&lt;/>me</a></li></ul></nav></header><div id=content><h1>Zig, the small language</h1><p>If you look at the HackerNews headlines and comments - you may notice that every now and then people praise <a href=https://ziglang.org>Zig</a>, a relatively young programming language for low-level programming.
Maybe not as low-level as assembler, but definitely as low-level as C or C++.</p><p>I&rsquo;m usually very skeptical about new languages, so naturally I wanted to give Zig a try. But after playing around and building a few toy projects with it - I shall say, I really enjoyed coding in Zig. It is very similar to the good side of C, when the language feels simple and small, resulting programs remain tiny and fast, and coding feels like &ldquo;coding&rdquo; and not like &ldquo;engineering&rdquo; or &ldquo;architecting&rdquo;. Zig remains fun.</p><h2 id=zig-is-small>Zig is small</h2><p>One of the reasons while Zig feels like fun, is because the language itself is small. One can explore the complete syntax and basic language constructs in less than an hour.
For example, here&rsquo;s my attempt to introduce Zig with a few lines of code:</p><div class=highlight><pre class=chroma><code class=language-zig data-lang=zig><span class=c1>// Single-line comments start with &#34;//&#34;, documentation comments start with &#34;///&#34;
</span><span class=c1></span><span class=w>
</span><span class=w></span><span class=kr>const</span><span class=w> </span><span class=n>x</span><span class=o>:</span><span class=w> </span><span class=kt>i32</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>42</span><span class=p>;</span><span class=w> </span><span class=c1>// immutable int32 value that can not be changed
</span><span class=c1></span><span class=kr>var</span><span class=w> </span><span class=n>y</span><span class=o>:</span><span class=w> </span><span class=kt>u32</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>    </span><span class=c1>// mutable unsigned int32 variable
</span><span class=c1></span><span class=kr>var</span><span class=w> </span><span class=n>z</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w> </span><span class=c1>// type can be omitted if it can be inferred from the value
</span><span class=c1></span><span class=w>
</span><span class=w></span><span class=c1>// There is no &#34;int&#34; type, all integers have fixed width.
</span><span class=c1>// Same about floats, there are f16, f32, f64 and f128.
</span><span class=c1>// For indices, &#34;intptr_t&#34; or &#34;size_t&#34; types use &#34;isize&#34; or &#34;usize&#34;.
</span><span class=c1></span><span class=w>
</span><span class=w></span><span class=c1>// All function parameters are immutable as if they are passed-by-value.
</span><span class=c1></span><span class=k>fn</span><span class=w> </span><span class=n>add_two_ints</span><span class=p>(</span><span class=n>a</span><span class=o>:</span><span class=w> </span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=o>:</span><span class=w> </span><span class=kt>i32</span><span class=p>)</span><span class=w> </span><span class=kt>i32</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>a</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// if statement looks like C
</span><span class=c1></span><span class=w>		</span><span class=k>return</span><span class=w> </span><span class=n>b</span><span class=p>;</span><span class=w>
</span><span class=w>	</span><span class=p>}</span><span class=w>
</span><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=n>a</span><span class=o>+</span><span class=n>b</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c1>// Arrays have fixed length, here numbers.len == 5
</span><span class=c1></span><span class=kr>const</span><span class=w> </span><span class=n>numbers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=n>_</span><span class=p>]</span><span class=kt>i32</span><span class=p>{</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>7</span><span class=w> </span><span class=p>};</span><span class=w>
</span><span class=w></span><span class=c1>// String literals are arrays of []u8
</span><span class=c1></span><span class=kr>const</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;hello&#34;</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=c1>// Arrays can be initialised with repeating values using ** operator
</span><span class=c1></span><span class=kr>const</span><span class=w> </span><span class=n>ten_zero_bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=n>_</span><span class=p>]</span><span class=kt>u8</span><span class=p>{</span><span class=mi>0</span><span class=p>}</span><span class=w> </span><span class=o>**</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=c1>// Arrays may contain a sentinel value at the end, here array.len == 4 and array[4] == 0.
</span><span class=c1></span><span class=kr>const</span><span class=w> </span><span class=n>array</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=n>_</span><span class=o>:</span><span class=mi>0</span><span class=p>]</span><span class=kt>u8</span><span class=w> </span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>};</span><span class=w>
</span><span class=w></span><span class=c1>// Slices are pointers to array data with associated length. The difference between
</span><span class=c1>// arrays and slices is that array&#39;s length is known at compile time, while slice
</span><span class=c1>// length is only known at runtime. Like arrays, slices also perform bounds checking.
</span><span class=c1></span><span class=kr>const</span><span class=w> </span><span class=n>full_slice</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>numbers</span><span class=p>[</span><span class=mi>0</span><span class=p>..];</span><span class=w> </span><span class=c1>// points at &amp;numbers[0] and has length of 5
</span><span class=c1></span><span class=kr>const</span><span class=w> </span><span class=n>short_slice</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>numbers</span><span class=p>[</span><span class=mi>1</span><span class=p>..</span><span class=mi>3</span><span class=p>];</span><span class=w> </span><span class=c1>// points at &amp;numbers[1] and has length of 2
</span><span class=c1></span><span class=w>
</span><span class=w></span><span class=k>fn</span><span class=w> </span><span class=n>count_nonzero</span><span class=p>(</span><span class=n>a</span><span class=o>:</span><span class=w> </span><span class=p>[]</span><span class=kr>const</span><span class=w> </span><span class=kt>i32</span><span class=p>)</span><span class=w> </span><span class=kt>i32</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>	</span><span class=kr>var</span><span class=w> </span><span class=n>count</span><span class=o>:</span><span class=w> </span><span class=kt>i32</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span><span class=w>	</span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>items</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=n>value</span><span class=o>|</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// &#34;for&#34; works only on arrays and slices, use &#34;while&#34; for generic loops.
</span><span class=c1></span><span class=w>		</span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>			</span><span class=k>continue</span><span class=p>;</span><span class=w>
</span><span class=w>		</span><span class=p>}</span><span class=w>
</span><span class=w>		</span><span class=n>count</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=c1>// there is no increment operator, but there are shortcuts for +=, *=, &gt;&gt;= etc.
</span><span class=c1></span><span class=w>	</span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kr>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=n>main</span><span class=p>()</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// main() is a special entry point to your program
</span><span class=c1></span><span class=w>	</span><span class=kr>var</span><span class=w> </span><span class=n>eight</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>add_two_ints</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>);</span><span class=w>
</span><span class=w>	</span><span class=kr>var</span><span class=w> </span><span class=n>nonzeros</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>count_nonzero</span><span class=p>(</span><span class=n>full_slice</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>Naturally, it has structs, error types, defer, enums and even means for meta-programming, and all of this can be discovered after skimming through <a href=https://ziglearn.org>https://ziglearn.org</a>.</p><p>I personally enjoy the way how Zig modules and macros are implemented. It feels very elegant to see existing language features being reused to achieve more functionality.</p><h2 id=zig-programs-are-small>Zig programs are small</h2><p>Zig runtime is very bare-bones: no GC, no utilities for HTTP or JSON, even no way to concatenate strings! But this also implies that most minimal Zig programs can remain small.</p><p>Let&rsquo;s try writing a &ldquo;Hello world&rdquo;:</p><div class=highlight><pre class=chroma><code class=language-zig data-lang=zig><span class=kr>const</span><span class=w> </span><span class=n>std</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>@import</span><span class=p>(</span><span class=s>&#34;std&#34;</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=kr>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=n>main</span><span class=p>()</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>  </span><span class=n>std</span><span class=p>.</span><span class=n>io</span><span class=p>.</span><span class=n>getStdOut</span><span class=p>().</span><span class=n>writeAll</span><span class=p>(</span><span class=s>&#34;Hello, World!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>)</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=k>unreachable</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>If we just compile it with a regular Zig compiler for amd64 we will result in a binary of ~2KB. By modern terms this is even smaller than a corresponding C binary.</p><p>This can further be improved by using Linux system calls directly and enabling <code>LDD</code> as a linker:</p><div class=highlight><pre class=chroma><code class=language-zig data-lang=zig><span class=kr>const</span><span class=w> </span><span class=n>std</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>@import</span><span class=p>(</span><span class=s>&#34;std&#34;</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=kr>const</span><span class=w> </span><span class=n>linux</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=p>.</span><span class=n>os</span><span class=p>.</span><span class=n>linux</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kr>pub</span><span class=w> </span><span class=kr>export</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=n>_start</span><span class=p>()</span><span class=w> </span><span class=n>callconv</span><span class=p>(.</span><span class=n>Naked</span><span class=p>)</span><span class=w> </span><span class=kt>noreturn</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>linux</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s>&#34;hello&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>linux</span><span class=p>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=err>$</span><span class=w> </span><span class=n>zig</span><span class=w> </span><span class=n>build</span><span class=o>-</span><span class=n>exe</span><span class=w> </span><span class=n>hello</span><span class=p>.</span><span class=n>zig</span><span class=w> </span><span class=o>--</span><span class=n>strip</span><span class=w> </span><span class=o>-</span><span class=n>OReleaseSmall</span><span class=w> </span><span class=o>--</span><span class=n>name</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=o>-</span><span class=n>target</span><span class=w> </span><span class=n>x86_64</span><span class=o>-</span><span class=n>linux</span><span class=w> </span><span class=o>-</span><span class=n>flto</span><span class=w> </span><span class=o>-</span><span class=n>fLLD</span><span class=w>
</span></code></pre></div><p>This gives a binary of ~700 bytes, which can additionally be stripped down using <code>sstrip</code> or custom linker scripts to ~200 bytes.</p><h2 id=zig-for-arduino>Zig for Arduino?</h2><p>Another platform that allows testing low-level languages is Arduino. Old ATMega MCUs barely have 2KB of RAM and only a few KB of ROM for code. Can Zig blink an LED without too many hacks?</p><p>Actually, yes:</p><div class=highlight><pre class=chroma><code class=language-zig data-lang=zig><span class=kr>const</span><span class=w> </span><span class=n>avr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kr>pub</span><span class=w> </span><span class=kr>const</span><span class=w> </span><span class=n>ddrb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>@intToPtr</span><span class=p>(</span><span class=o>*</span><span class=kr>volatile</span><span class=w> </span><span class=kt>u8</span><span class=p>,</span><span class=w> </span><span class=mh>0x24</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=kr>pub</span><span class=w> </span><span class=kr>const</span><span class=w> </span><span class=n>portb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>@intToPtr</span><span class=p>(</span><span class=o>*</span><span class=kr>volatile</span><span class=w> </span><span class=kt>u8</span><span class=p>,</span><span class=w> </span><span class=mh>0x25</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kr>const</span><span class=w> </span><span class=n>led_pin</span><span class=o>:</span><span class=w> </span><span class=kt>u8</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=kr>const</span><span class=w> </span><span class=n>led_bit</span><span class=o>:</span><span class=w> </span><span class=kt>u8</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>led_pin</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=kr>const</span><span class=w> </span><span class=n>loop_ms</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x0a52</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span><span class=w> </span><span class=n>flipLed</span><span class=p>()</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>avr</span><span class=p>.</span><span class=n>portb</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=o>^=</span><span class=w> </span><span class=n>led_bit</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span><span class=w> </span><span class=n>delay</span><span class=p>(</span><span class=n>ms</span><span class=o>:</span><span class=w> </span><span class=kt>u8</span><span class=p>)</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kr>var</span><span class=w> </span><span class=n>count</span><span class=o>:</span><span class=w> </span><span class=kt>u8</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>count</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>ms</span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=p>(</span><span class=n>count</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kr>var</span><span class=w> </span><span class=n>loop</span><span class=o>:</span><span class=w> </span><span class=kt>u16</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>loop</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>loop_ms</span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=p>(</span><span class=n>loop</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=k>asm</span><span class=w> </span><span class=kr>volatile</span><span class=w> </span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=w> </span><span class=o>:::</span><span class=w> </span><span class=s>&#34;memory&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kr>export</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=n>main</span><span class=p>()</span><span class=w> </span><span class=kt>noreturn</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>avr</span><span class=p>.</span><span class=n>ddrb</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>led_bit</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=n>avr</span><span class=p>.</span><span class=n>portb</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>led_bit</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>flipLed</span><span class=p>();</span><span class=w>
</span><span class=w>        </span><span class=n>delay</span><span class=p>(</span><span class=mi>250</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>This can be cross-compiled for the <code>avr-freestanding-none</code> target and it produces the following assembly code:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>main:
	ldi	r24, 32
	out	4, r24
	out	5, r24
	ldi	r18, 0
	ldi	r19, 0
	ldi	r25, 10
.LBB0_1:
	in	r20, 5
	eor	r20, r24
	out	5, r20
	ldi	r20, 0
.LBB0_2:
	cpi	r20, -6
	breq	.LBB0_1
	movw	r30, r18
.LBB0_4:
	cpi	r30, 82
	cpc	r31, r25
	brsh	.LBB0_6
	adiw	r30, 1
	rjmp	.LBB0_4
.LBB0_6:
	inc	r20
	rjmp	.LBB0_2
</code></pre></div><p>20 assembly instructions that toggle the LED (in+eor+out) and do the countdown loop in between the blinks. Just like the C compiler would do.</p><h2 id=zig-for-demoscene>Zig for Demoscene?</h2><p>So far Zig has been a decent competitor to C. There is yet another niche, where no-nonsense languages like C have been shining for decades - demoscene. Nowhere close to a traditional industrial programming, demoscene is an art, where some visually or audibly appealing applications are written to be executed in a limited environment. Most often a binary size is a constraint, and people fit amazing artworks into anything from 512 to 4096 bytes.</p><p>Of course, it&rsquo;s hard to build a cross-platform binary to be that small, so let&rsquo;s assume that our platform is a modern Linux distro with SDL2. I never participated in demo scene myself, so don&rsquo;t expect much. My goal here is to get SDL2 + Zig running with something visual in less than 4KB.</p><div class=highlight><pre class=chroma><code class=language-zig data-lang=zig><span class=kr>const</span><span class=w> </span><span class=n>sdl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>@cImport</span><span class=p>({</span><span class=w>
</span><span class=w>    </span><span class=nb>@cInclude</span><span class=p>(</span><span class=s>&#34;SDL2/SDL.h&#34;</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>});</span><span class=w>
</span><span class=w></span><span class=kr>const</span><span class=w> </span><span class=n>std</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>@import</span><span class=p>(</span><span class=s>&#34;std&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kr>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=n>main</span><span class=p>()</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_Init</span><span class=p>(</span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_INIT_VIDEO</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_Quit</span><span class=p>();</span><span class=w>
</span><span class=w>    </span><span class=kr>const</span><span class=w> </span><span class=n>window</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_CreateWindow</span><span class=p>(</span><span class=s>&#34;Hello&#34;</span><span class=p>,</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_WINDOWPOS_CENTERED</span><span class=p>,</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_WINDOWPOS_CENTERED</span><span class=p>,</span><span class=w> </span><span class=mi>166</span><span class=p>,</span><span class=w> </span><span class=mi>166</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_DestroyWindow</span><span class=p>(</span><span class=n>window</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=kr>const</span><span class=w> </span><span class=n>surface</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_GetWindowSurface</span><span class=p>(</span><span class=n>window</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kr>var</span><span class=w> </span><span class=n>quit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>quit</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kr>var</span><span class=w> </span><span class=n>event</span><span class=o>:</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_Event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>undefined</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_PollEvent</span><span class=p>(</span><span class=o>&amp;</span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=err>@</span><span class=s>&#34;type&#34;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_QUIT</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>                    </span><span class=n>quit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span><span class=w>                </span><span class=p>},</span><span class=w>
</span><span class=w>                </span><span class=k>else</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{},</span><span class=w>
</span><span class=w>            </span><span class=p>}</span><span class=w>
</span><span class=w>        </span><span class=p>}</span><span class=w>
</span><span class=w>				</span><span class=c1>// Draw a white cross on red background
</span><span class=c1></span><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_FillRect</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mh>0xff0000</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=kr>const</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_Rect</span><span class=p>{</span><span class=w> </span><span class=p>.</span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>33</span><span class=p>,</span><span class=w> </span><span class=p>.</span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>66</span><span class=p>,</span><span class=w> </span><span class=p>.</span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>,</span><span class=w> </span><span class=p>.</span><span class=n>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>34</span><span class=w> </span><span class=p>};</span><span class=w>
</span><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_FillRect</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>v</span><span class=p>,</span><span class=w> </span><span class=mh>0xffffff</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=kr>const</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_Rect</span><span class=p>{</span><span class=w> </span><span class=p>.</span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>66</span><span class=p>,</span><span class=w> </span><span class=p>.</span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>33</span><span class=p>,</span><span class=w> </span><span class=p>.</span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>34</span><span class=p>,</span><span class=w> </span><span class=p>.</span><span class=n>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=p>};</span><span class=w>
</span><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_FillRect</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>h</span><span class=p>,</span><span class=w> </span><span class=mh>0xffffff</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sdl</span><span class=p>.</span><span class=n>SDL_UpdateWindowSurface</span><span class=p>(</span><span class=n>window</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=c1>// zig build-exe main.zig -OReleaseSmall --strip $(shell pkg-config --libs --cflags sdl2) -lc
</span></code></pre></div><p>Such an executable, dynamically linked, is 3700 bytes. Yeah, there&rsquo;s not much space left for the actual art, but then again - further optimisations and linker hacks should be able to strip this down a bit. What impressed me the most is how easy it was to deal with SDL2 (a C library) from Zig without having to download any wrappers or writing any of the glue code.</p><h2 id=zig-for-everything-else>Zig for everything else</h2><p>Being small is probably the best thing about Zig. It takes a few days to become familiar and productive with the language. Zig has a wonderful integration with C, including C headers and calling C functions from Zig via FFI just works. This already allows using Zig where C would have been used instead and that&rsquo;s quite a large area.</p><p>I look forward to Zig becoming more stable, hopefully having a self-hosted compiler and a package manager. It&rsquo;s a very appealing language to the modern low-end (and not only) applications, that deserves a bright future.</p><p>I hope you’ve enjoyed this article. You can follow – and contribute to – on <a href=https://github.com/zserge>Github</a>, <a href=https://twitter.com/zsergo>Twitter</a> or subscribe via <a href=/rss.xml>rss</a>.</p><p class=date style=text-align:right><em>Jun 01, 2022</em></p></div><footer><p>&copy;2012&ndash;2022 &#183;
<a class=h-card rel=me href=https://zserge.com/>Serge Zaitsev</a> &#183;
<a href=mailto:hello@zserge.com rel=me>hello@zserge.com</a></p></footer><script>(function(e,t,n,i,s,a,c){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)};a=t.createElement(i);c=t.getElementsByTagName(i)[0];a.async=true;a.src=s;c.parentNode.insertBefore(a,c)})(window,document,"galite","script","https://cdn.jsdelivr.net/npm/ga-lite@2/dist/ga-lite.min.js");galite('create','UA-33644825-1','auto');galite('send','pageview');</script><script>new Image().src='https://nullitics.com/file.gif?u='+encodeURI(location.href)+'&r='+encodeURI(document.referrer)+'&d='+screen.width</script><noscript><img src=https://nullitics.com/file.gif></noscript></body></html>