<!doctype html><html lang=en><head><meta charset=utf-8><title>How to sign release apk with gradle</title><meta name=description content="Signing apks without boilerplate code"><meta name=author content="Serge Zaitsev"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=data:,><link rel="shortcut icon" sizes=32x32 href=/favicon.png><link rel="shortcut icon" sizes=192x192 href=/favicon-192x192.png><link rel=apple-touch-icon href=/favicon-192x192.png><link rel=alternate type=application/rss+xml title=RSS href=/rss.xml><link rel=canonical href=https://zserge.com/posts/android-signing/><meta property="og:title" content="How to sign release apk with gradle"><meta property="og:type" content="article"><meta property="og:url" content="https://zserge.com/posts/android-signing/"><meta property="og:image" content="https://zserge.com/logo.png"><meta property="og:description" content="Signing apks without boilerplate code"><meta property="og:locale" content="en_US"><meta name=twitter:card content="Signing apks without boilerplate code"><meta name=twitter:site content="@zsergo"><style type=text/css>body{padding:1rem;margin:auto;max-width:46rem;font-family:pt serif,Georgia,Cambria,times new roman,Times,serif;line-height:1.5;font-size:20px;color:rgba(0,0,0,.87);-webkit-font-smoothing:antialiased;font-weight:300}nav{display:flex;justify-content:space-between;align-items:center;margin:1em 0 3em}nav ul,nav li{display:inline-block;list-style:none;margin:0 0 0 .5rem;padding:0}nav ul{margin-right:1rem}.logo{background-color:rgba(0,0,0,.87);color:#fff;min-width:48px;min-height:48px;font-size:28px;border-radius:2px;display:flex;justify-content:center;align-items:center}.logo:hover{color:#fff}h1,h2{line-height:1.2;font-family:roboto,system-ui,segoe ui,Helvetica,Arial,sans-serif;font-weight:400;text-transform:uppercase;margin:1.34em 0 0}h1{font-size:1.95em}h2{font-size:1.25em;border-bottom:2px solid rgba(0,0,0,.87)}h1 a{color:rgba(0,0,0,.87)}p{margin:.67em 0 1em}a{color:#0076df;text-decoration:none;word-break:break-word}a:hover{color:rgba(0,0,0,.87)}ul,ol{list-style-position:outside;margin-left:1em}img{display:block;margin-left:auto;margin-right:auto;max-width:100%}pre,code{font-family:roboto mono,SFMono-Regular,Consolas,liberation mono,Menlo,monospace;font-weight:400;font-size:18px;color:rgba(0,0,0,.6);background:#eee}code{padding:.2rem .4rem;font-size:14px;border-radius:2px}pre{overflow-y:auto;line-height:20px;border-radius:2px;padding:1em}pre code{font-size:14px;padding:0;color:rgba(0,0,0,.87)}footer{font-size:12px}@media(prefers-color-scheme:dark){.logo{color:#444;background-color:#e4e4e4}.logo:hover{color:#444}body,h1 a,h2 a{background-color:#444;color:#e4e4e4}pre,pre code{background:#333;color:#e4e4e4}h2{border-bottom:1px solid #e4e4e4}code{color:#aaa;background:#333}a{color:#e39777}a:hover{color:#e4e4e4}img{filter:grayscale(30%)}}.hl{display:block;width:100%;background-color:#ffc}.ow,.gh,.gp,.gs,.gu,.nt,.nn,.ne,.ni,.nc,.kr,.kn,.kd,.kc,.k{font-weight:700}.c,.ch,.cm,.c1,.cs,.ge{color:#777}</style><link rel="shortcut icon" href=/favicon.ico></head><body><header><nav><a class=logo href=/>Z</a><ul><li><a href=/about/>about</a></li><li><a href=/posts/>posts</a></li><li><a href=https://twitter.com/zsergo rel=me>@me</a></li><li><a href=https://github.com/zserge rel=me>&lt;/>me</a></li></ul></nav></header><div id=content><h1>How to sign release apk with gradle</h1><p>Whenever I prepare my APK for the release - I used to do the following steps:</p><ol><li>Copy keystore to the project directory</li><li>Copy gradle.properties into the project directory with keystore name, alias
and password defined</li><li>Copy some code from <a href=https://www.timroes.de/2013/09/22/handling-signing-configs-with-gradle/>some blog</a> that would load the properties and set up
the signing</li><li>Finally, do <code>gradle build</code></li></ol><p>But why not to move the boilderplate out of build.gradle?</p><h2 id=helper-signing-script>Helper signing script</h2><p>I wrote a tiny helper script that can be included into the projects:</p><div class=highlight><pre class=chroma><code class=language-gradle data-lang=gradle><span class=kt>def</span> <span class=n>signingProperties</span> <span class=o>=</span> <span class=s2>&#34;signing.properties&#34;</span>
<span class=kt>def</span> <span class=n>signingKeys</span> <span class=o>=</span> <span class=o>[</span>
	<span class=n>storeFile</span>     <span class=o>:</span> <span class=o>{</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>file</span><span class=o>(</span><span class=n>x</span><span class=o>)},</span>
	<span class=n>storePassword</span> <span class=o>:</span> <span class=o>{</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>x</span><span class=o>},</span>
	<span class=n>keyAlias</span>      <span class=o>:</span> <span class=o>{</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>x</span><span class=o>},</span>
	<span class=n>keyPassword</span>   <span class=o>:</span> <span class=o>{</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>x</span><span class=o>},</span>
<span class=o>]</span>

<span class=c1>// Find signing.properties in the project root, or in $HOME/.gradle
</span><span class=c1></span><span class=kt>def</span> <span class=n>f</span> <span class=o>=</span> <span class=o>[</span><span class=s2>&#34;${rootDir}/${signingProperties}&#34;</span><span class=o>,</span> <span class=s2>&#34;${gradle.gradleUserHomeDir}/${signingProperties}&#34;</span><span class=o>].</span><span class=na>find</span> <span class=o>{</span> <span class=n>file</span><span class=o>(</span><span class=n>it</span><span class=o>).</span><span class=na>exists</span><span class=o>()</span> <span class=o>}</span>

<span class=k>if</span> <span class=o>(</span><span class=n>f</span><span class=o>)</span> <span class=o>{</span>
	<span class=n>logger</span><span class=o>.</span><span class=na>info</span> <span class=s2>&#34;Loading signing properties from ${f}&#34;</span>
	<span class=kt>def</span> <span class=n>props</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=o>()</span>
	<span class=n>props</span><span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>f</span><span class=o>))</span>

	<span class=c1>// For each property apply it to the release signing config
</span><span class=c1></span>	<span class=n>signingKeys</span><span class=o>.</span><span class=na>any</span> <span class=o>{</span> <span class=n>k</span><span class=o>,</span> <span class=n>fn</span> <span class=o>-&gt;</span>
		<span class=k>if</span> <span class=o>(!</span><span class=n>props</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>k</span><span class=o>))</span> <span class=o>{</span>
			<span class=n>logger</span><span class=o>.</span><span class=na>error</span> <span class=s2>&#34;Missing property ${k}&#34;</span>
			<span class=n>android</span><span class=o>.</span><span class=na>buildTypes</span><span class=o>.</span><span class=na>release</span><span class=o>.</span><span class=na>signingConfig</span> <span class=o>=</span> <span class=kc>null</span>
			<span class=k>return</span> <span class=kc>true</span>
		<span class=o>}</span>
		<span class=n>android</span><span class=o>.</span><span class=na>signingConfigs</span><span class=o>.</span><span class=na>release</span><span class=o>[</span><span class=n>k</span><span class=o>]</span> <span class=o>=</span> <span class=n>fn</span><span class=o>(</span><span class=n>props</span><span class=o>[</span><span class=n>k</span><span class=o>]);</span>
		<span class=k>return</span>
	<span class=o>}</span>
<span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
	<span class=n>logger</span><span class=o>.</span><span class=na>info</span> <span class=s2>&#34;Missing ${signingProperties} file&#34;</span>
	<span class=n>android</span><span class=o>.</span><span class=na>buildTypes</span><span class=o>.</span><span class=na>release</span><span class=o>.</span><span class=na>signingConfig</span> <span class=o>=</span> <span class=kc>null</span>
<span class=o>}</span>
</code></pre></div><p>It scans for the signing.propeties file in the project directory and in the
gradle home directory, then it parses the properties and configures the build.</p><h2 id=usage>usage</h2><p>Now I do the following.</p><p>Create signing.properties in my $HOME/.gradle (once for all projects):</p><div class=highlight><pre class=chroma><code class=language-ini data-lang=ini><span class=na>storeFile</span><span class=o>=</span><span class=s>my.keystore</span>
<span class=na>keyAlias</span><span class=o>=</span><span class=s>myalias</span>
<span class=na>storePassword</span><span class=o>=</span><span class=s>mypassword</span>
<span class=na>keyPassword</span><span class=o>=</span><span class=s>mypassword2</span>
</code></pre></div><p>Put my.keystore into $HOME/.gradle (once for all projects).</p><p>Edit build.gradle to use release singing config (most likely it is already done
did it the app has been signed in the past):</p><div class=highlight><pre class=chroma><code class=language-gradle data-lang=gradle><span class=n>android</span> <span class=o>{</span>
	<span class=n>signingConfigs</span> <span class=o>{</span>
		<span class=n>release</span>
	<span class=o>}</span>
	<span class=n>buildTypes</span> <span class=o>{</span>
		<span class=n>release</span> <span class=o>{</span>
			<span class=n>signingConfig</span> <span class=n>signingConfigs</span><span class=o>.</span><span class=na>release</span>
		<span class=o>}</span>
	<span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>Finally, I include the script above. I simply use the github link:</p><div class=highlight><pre class=chroma><code class=language-gradle data-lang=gradle>	<span class=n>apply</span> <span class=nl>from:</span> <span class=s1>&#39;https://raw.github.com/trikita/gradle-android-signing/master/gradle-android-signing.gradle&#39;</span>
</code></pre></div><p>Done. One &lsquo;apply from&rsquo; line and signing just works.</p><p>You may try it, too. Sources are available on <a href=https://github.com/trikita/gradle-android-signing>github</a>, so please file an
issue or a pull request if something it not working.</p><p>I hope you’ve enjoyed this article. You can follow – and contribute to – on <a href=https://github.com/zserge>Github</a>, <a href=https://twitter.com/zsergo>Twitter</a> or subscribe via <a href=/rss.xml>rss</a>.</p><p class=date style=text-align:right><em>Aug 09, 2015</em></p><p>See also:
<a href=/posts/buck-build-system/>Buck - life is too short to spend a minute for each build</a> and <a href=/posts/>more</a>.</p></div><footer><p>&copy;2012&ndash;2021 &#183;
<a href=https://zserge.com>Serge Zaitsev</a> &#183;
<a href=mailto:hello@zserge.com rel=me>hello@zserge.com</a></p></footer><script>(function(e,t,n,i,s,a,c){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)};a=t.createElement(i);c=t.getElementsByTagName(i)[0];a.async=true;a.src=s;c.parentNode.insertBefore(a,c)})(window,document,"galite","script","https://cdn.jsdelivr.net/npm/ga-lite@2/dist/ga-lite.min.js");galite('create','UA-33644825-1','auto');galite('send','pageview');</script><script>new Image().src='https://nullitics.com/file.gif?u='+encodeURI(location.href)+'&r='+encodeURI(document.referrer)+'&d='+screen.width</script><noscript><img src=https://nullitics.com/file.gif></noscript></body></html>