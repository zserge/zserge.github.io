<!doctype html><html lang=en><head><meta charset=utf-8><title>How to sign release apk with gradle</title><meta name=description content="Signing apks without boilerplate code"><meta name=author content="Serge Zaitsev"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel="shortcut icon" type=image/png href=/favicon.png><link rel=alternate type=application/rss+xml title=RSS href=/rss.xml><link rel=canonical href=https://zserge.com/posts/android-signing/><meta property="og:title" content="How to sign release apk with gradle"><meta property="og:type" content="article"><meta property="og:url" content="https://zserge.com/posts/android-signing/"><meta property="og:image" content="https://zserge.com/logo.png"><meta property="og:description" content="Signing apks without boilerplate code"><meta property="og:locale" content="en_US"><meta name=twitter:card content="Signing apks without boilerplate code"><meta name=twitter:site content="@zsergo"><link href=/styles.css rel=stylesheet type=text/css><link rel="shortcut icon" href=/favicon.ico></head><body><header><nav><a class=logo href=/>Z</a></nav><div class=empty></div><nav><section><a href=/about/>about</a>
<a href=/posts/>posts</a></section><section><a href=https://twitter.com/zsergo>@me</a>
<a href=https://github.com/zserge>&lt;/>me</a></section></nav></header><div id=content><h1>How to sign release apk with gradle</h1><p>Whenever I prepare my APK for the release - I used to do the following steps:</p><ol><li>Copy keystore to the project directory</li><li>Copy gradle.properties into the project directory with keystore name, alias
and password defined</li><li>Copy some code from <a href=https://www.timroes.de/2013/09/22/handling-signing-configs-with-gradle/>some blog</a> that would load the properties and set up
the signing</li><li>Finally, do <code>gradle build</code></li></ol><p>But why not to move the boilderplate out of build.gradle?</p><h2 id=helper-signing-script>Helper signing script</h2><p>I wrote a tiny helper script that can be included into the projects:</p><div class=highlight><pre class=chroma><code class=language-gradle data-lang=gradle><span class=kt>def</span> <span class=n>signingProperties</span> <span class=o>=</span> <span class=s2>&#34;signing.properties&#34;</span>
<span class=kt>def</span> <span class=n>signingKeys</span> <span class=o>=</span> <span class=o>[</span>
	<span class=n>storeFile</span>     <span class=o>:</span> <span class=o>{</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>file</span><span class=o>(</span><span class=n>x</span><span class=o>)},</span>
	<span class=n>storePassword</span> <span class=o>:</span> <span class=o>{</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>x</span><span class=o>},</span>
	<span class=n>keyAlias</span>      <span class=o>:</span> <span class=o>{</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>x</span><span class=o>},</span>
	<span class=n>keyPassword</span>   <span class=o>:</span> <span class=o>{</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>x</span><span class=o>},</span>
<span class=o>]</span>

<span class=c1>// Find signing.properties in the project root, or in $HOME/.gradle
</span><span class=c1></span><span class=kt>def</span> <span class=n>f</span> <span class=o>=</span> <span class=o>[</span><span class=s2>&#34;${rootDir}/${signingProperties}&#34;</span><span class=o>,</span> <span class=s2>&#34;${gradle.gradleUserHomeDir}/${signingProperties}&#34;</span><span class=o>].</span><span class=na>find</span> <span class=o>{</span> <span class=n>file</span><span class=o>(</span><span class=n>it</span><span class=o>).</span><span class=na>exists</span><span class=o>()</span> <span class=o>}</span>

<span class=k>if</span> <span class=o>(</span><span class=n>f</span><span class=o>)</span> <span class=o>{</span>
	<span class=n>logger</span><span class=o>.</span><span class=na>info</span> <span class=s2>&#34;Loading signing properties from ${f}&#34;</span>
	<span class=kt>def</span> <span class=n>props</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=o>()</span>
	<span class=n>props</span><span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>f</span><span class=o>))</span>

	<span class=c1>// For each property apply it to the release signing config
</span><span class=c1></span>	<span class=n>signingKeys</span><span class=o>.</span><span class=na>any</span> <span class=o>{</span> <span class=n>k</span><span class=o>,</span> <span class=n>fn</span> <span class=o>-&gt;</span>
		<span class=k>if</span> <span class=o>(!</span><span class=n>props</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>k</span><span class=o>))</span> <span class=o>{</span>
			<span class=n>logger</span><span class=o>.</span><span class=na>error</span> <span class=s2>&#34;Missing property ${k}&#34;</span>
			<span class=n>android</span><span class=o>.</span><span class=na>buildTypes</span><span class=o>.</span><span class=na>release</span><span class=o>.</span><span class=na>signingConfig</span> <span class=o>=</span> <span class=kc>null</span>
			<span class=k>return</span> <span class=kc>true</span>
		<span class=o>}</span>
		<span class=n>android</span><span class=o>.</span><span class=na>signingConfigs</span><span class=o>.</span><span class=na>release</span><span class=o>[</span><span class=n>k</span><span class=o>]</span> <span class=o>=</span> <span class=n>fn</span><span class=o>(</span><span class=n>props</span><span class=o>[</span><span class=n>k</span><span class=o>]);</span>
		<span class=k>return</span>
	<span class=o>}</span>
<span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
	<span class=n>logger</span><span class=o>.</span><span class=na>info</span> <span class=s2>&#34;Missing ${signingProperties} file&#34;</span>
	<span class=n>android</span><span class=o>.</span><span class=na>buildTypes</span><span class=o>.</span><span class=na>release</span><span class=o>.</span><span class=na>signingConfig</span> <span class=o>=</span> <span class=kc>null</span>
<span class=o>}</span>
</code></pre></div><p>It scans for the signing.propeties file in the project directory and in the
gradle home directory, then it parses the properties and configures the build.</p><h2 id=usage>usage</h2><p>Now I do the following.</p><p>Create signing.properties in my $HOME/.gradle (once for all projects):</p><div class=highlight><pre class=chroma><code class=language-ini data-lang=ini><span class=na>storeFile</span><span class=o>=</span><span class=s>my.keystore</span>
<span class=na>keyAlias</span><span class=o>=</span><span class=s>myalias</span>
<span class=na>storePassword</span><span class=o>=</span><span class=s>mypassword</span>
<span class=na>keyPassword</span><span class=o>=</span><span class=s>mypassword2</span>
</code></pre></div><p>Put my.keystore into $HOME/.gradle (once for all projects).</p><p>Edit build.gradle to use release singing config (most likely it is already done
did it the app has been signed in the past):</p><div class=highlight><pre class=chroma><code class=language-gradle data-lang=gradle><span class=n>android</span> <span class=o>{</span>
	<span class=n>signingConfigs</span> <span class=o>{</span>
		<span class=n>release</span>
	<span class=o>}</span>
	<span class=n>buildTypes</span> <span class=o>{</span>
		<span class=n>release</span> <span class=o>{</span>
			<span class=n>signingConfig</span> <span class=n>signingConfigs</span><span class=o>.</span><span class=na>release</span>
		<span class=o>}</span>
	<span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>Finally, I include the script above. I simply use the github link:</p><div class=highlight><pre class=chroma><code class=language-gradle data-lang=gradle>	<span class=n>apply</span> <span class=nl>from:</span> <span class=s1>&#39;https://raw.github.com/trikita/gradle-android-signing/master/gradle-android-signing.gradle&#39;</span>
</code></pre></div><p>Done. One &lsquo;apply from&rsquo; line and signing just works.</p><p>You may try it, too. Sources are available on <a href=https://github.com/trikita/gradle-android-signing>github</a>, so please file an
issue or a pull request if something it not working.</p><p>I hope you’ve enjoyed this article. You can follow – and contribute to – on <a href=https://github.com/zserge>Github</a>, <a href=https://twitter.com/zsergo>Twitter</a> or subscribe via <a href=/rss.xml>rss</a>.</p><p class=date style=text-align:right><em>Aug 09, 2015</em></p><p>See also:
<a href=/posts/buck-build-system/>Buck - life is too short to spend a minute for each build</a>
and <a href=/posts/>more</a>.</p></div><footer><p>&copy;2012&ndash;2020 &#183;
<a href=https://zserge.com>Serge Zaitsev</a> &#183;
<a href=mailto:zaitsev.serge@gmail.com>zaitsev.serge@gmail.com</a></p></footer><script src=https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js></script><script>WebFontConfig={google:{families:['PT Serif','Roboto','Roboto Mono']}};(function(d){var wf=d.createElement('script'),s=d.scripts[0];wf.src='https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js';s.parentNode.insertBefore(wf,s);})(document);</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-33644825-1','zserge.com');ga('send','pageview');</script><script>new Image().src='https://nullitics.com/1.gif?r='+encodeURI(document.referrer)</script><noscript><img src=https://nullitics.com/foo.gif></noscript></body></html>